<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=9" />
    <meta name="generator" content="Doxygen 1.9.1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>IOT Dash: IotDash.Services.Mqtt.Implementation.MqttNet_Mediator Class Reference</title>
    <link href="tabs.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css" />
    <script type="text/javascript" src="search/searchdata.js"></script>
    <script type="text/javascript" src="search/search.js"></script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="docs.css" rel="stylesheet" type="text/css" />
</head>
<body>
    <div id="top">
        <!-- do not remove this div, it is closed by doxygen! -->
        <div id="titlearea">
            <table cellspacing="0" cellpadding="0">
                <tbody>
                    <tr style="height: 56px;">
                        <td id="projectalign" style="padding-left: 0.5em;">
                            <div id="projectname">
                                IOT Dash
                            </div>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <script type="text/javascript">
            $(() => {
                x = [...document.body.querySelectorAll('.memdoc > p')]
                    .map(p => {
                        var memdoc = p.parentElement;
                        params = [...memdoc.querySelectorAll('.params .paramname')].map(p => p.textContent);
                        for (let em of p.querySelectorAll('em')) {
                            if (params.includes(em.textContent)) {
                                em.classList.add('paramname');
                            }
                        }
                        return p;
                    });
            });
        </script>
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Programmer's manual </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1">Application context</a></li>
<li class="level1"><a href="#autotoc_md2">Conceptual model</a></li>
<li class="level1"><a href="#autotoc_md3">Architecture</a><ul><li class="level2"><a href="#autotoc_md4">Web server pipeline</a><ul><li class="level3"><a href="#autotoc_md5">Authorization and Authentication</a></li>
<li class="level3"><a href="#autotoc_md6">Controllers and Hubs</a></li>
</ul>
</li>
<li class="level2"><a href="#autotoc_md7">Services</a><ul><li class="level3"><a href="#autotoc_md8">Model stores</a></li>
<li class="level3"><a href="#autotoc_md9">Expression evaluation</a></li>
<li class="level3"><a href="#autotoc_md10">History logging</a></li>
<li class="level3"><a href="#autotoc_md11">MQTT Client</a></li>
<li class="level3"><a href="#autotoc_md12">Messaging</a></li>
<li class="level3"><a href="#autotoc_md13">Logging</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="textblock"><p ><a class="anchor" id="md_docs_main"></a> This is an in depth manual about the architecture and individual components' implementation of the IOT-Dash application backend.</p>
<p >Related documents:</p><ul>
<li><a href="https://github.com/Muph0/iot-dash-backend">README</a></li>
<li><a href="rest.html">REST API and scheme documentation</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md1"></a>
Application context</h1>
<p >The backend is a middle man between the web application and the devices. It is responsible for managing devices and presenting data for users of front end application. See in the following component illustration.</p>
<div class="fragment"><div class="line">                                                     devices</div>
<div class="line">┌───────────────┐       ┌─────────────────┐          ┌─────┐</div>
<div class="line">│ iot-dash-app  │       │                 │◄────┬────┤     │</div>
<div class="line">└──────┬────────┘       │   MQTT Broker   │     │    ├─────┤</div>
<div class="line">       │                │                 │     ├────┤     │</div>
<div class="line">       │ http           └───┬─────────────┘     │    ├─────┤</div>
<div class="line">       │                  ▲ │                   ├────┤     │</div>
<div class="line">       │                  │ │ publish &amp;         │    ├─────┤</div>
<div class="line">       ▼                  │ │ subscribe         └────┤     │</div>
<div class="line">   REST api               │ ▼                        ├─────┤</div>
<div class="line">┌─────────────────────────┴───────────────┐          │  .  │</div>
<div class="line">│            iot-dash-backend             │          │  .  │</div>
<div class="line">└────────────────────┬────────────────────┘          │  .  │</div>
<div class="line">                     │                               │     │</div>
<div class="line">┌────────────────────┴────────────────────┐          │     │</div>
<div class="line">│              MySQL database             │          │     │</div>
<div class="line">└─────────────────────────────────────────┘          └─────┘</div>
</div><!-- fragment --> <h1><a class="anchor" id="autotoc_md2"></a>
Conceptual model</h1>
<p >The conceptual model of the application is illustrated in the following UML diagram. Classes with relevant documentation are in the <a class="el" href="namespaceIotDash_1_1Data_1_1Model.html">IotDash.Data.Model</a> namespace. Application uses Entity Framework Core to generate SQL schema from C# classes.</p>
<p ><img src="model.png" alt="Conceptual model" class="inline"/></p>
<h1><a class="anchor" id="autotoc_md3"></a>
Architecture</h1>
<p >Service-oriented architecture of the backend uses dependency injection provided by the ASP.NET Core library. The functionality is separated into coherent groups called <em>services</em> which exchange information through a mediator pattern (<a class="el" href="classIotDash_1_1Services_1_1Messaging_1_1MessageMediator.html" title="This class is a specialisation of the AbstractMediator&lt;TChannelKey, TMsg&gt; which mediates objects over...">IotDash.Services.Messaging.MessageMediator</a> class).</p>
<p >Services are registered by scanning the assembly for implementations of the <a class="el" href="interfaceIotDash_1_1Installers_1_1IInstaller.html" title="Represents a contract for service installer. Assembly-wide scan for implementations of this interface...">IotDash.Installers.IInstaller</a> interface, which are located in the <a class="el" href="namespaceIotDash_1_1Installers.html">IotDash.Installers</a> namespace. Then the installers are instantiated and their <code>Install()</code> methods are called.</p>
<p ><img src="inherit_graph_47.png" alt="IInstallers" class="inline"/></p>
<p >The dependency container registers services by Type, but not directly by the service type. The services are registered by an interface or an abstract type to allow easy swap of implementation of different services.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Web server pipeline</h2>
<p >The web server uses the middleware pattern to realize the server pipeline. Each request is passed through the pipeline call stack. The pipeline is configured in the <a class="el" href="classIotDash_1_1Startup.html" title="This class is responsible for configuring all service and installing them into the container....">IotDash.Startup</a> class.</p>
<p ><img src="pipeline.svg" alt="Web server pipeline" style="pointer-events: none;" class="inline"/></p>
<p >Different parts of the pipeline are realised by the following classes:</p><ul>
<li><b>CORS</b>: Microsoft.AspNetCore.Builder.CorsMiddlewareExtensions</li>
<li><b>Routing</b>: Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware</li>
<li><b>Error reporting</b>: <a class="el" href="classIotDash_1_1Middleware_1_1ApiErrorReporting.html">IotDash.Middleware.ApiErrorReporting</a></li>
<li><b>Authentication</b>: Microsoft.AspNetCore.Authentication.AuthenticationMiddleware</li>
<li><b>Authorization</b>: Microsoft.AspNetCore.Authorization.AuthorizationMiddleware</li>
<li>Different endpoints are registered by providing appropriate implementation of Microsoft.AspNetCore.Routing.IEndpointRouteBuilder to the Microsoft.AspNetCore.Routing.EndpointMiddleware on top of the pipeline.</li>
</ul>
<p >Static files hosted by this backend application are the files of the frontend application.</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Authorization and Authentication</h3>
<p >Authentication is realised via standard ASP.NET authenticator service with the JWT extension. The ASP.NET authenticators are configured and registered in the AuthenticationInstaller.</p>
<p >Authorization is realised via <a class="el" href="classIotDash_1_1Authorization_1_1Policies.html" title="Contains static generator methods for different policies.">IotDash.Authorization.Policies</a> registering different <a class="el" href="namespaceIotDash_1_1Authorization_1_1Requirements.html">IotDash.Authorization.Requirements</a> onto various controller routes. The requirements are realised by their relevant AuthorizationHandlers.</p>
<h3><a class="anchor" id="autotoc_md6"></a>
Controllers and Hubs</h3>
<p >Controllers provide endpoints for HTTP routes. They are registered automatically on the <a class="el" href="classIotDash_1_1Startup.html#ad3b4c11fdc5028d24e1fbb707fe76b56" title="This method gets called by the runtime. HTTP request pipeline is configured in this method.">IotDash.Startup.Configure</a>.</p><ul>
<li><a class="el" href="classIotDash_1_1Controllers_1_1V1_1_1IdentityController.html" title="The IotDash.Controllers.V1.IdentityController provides route endpoints for user account management.">IotDash.Controllers.V1.IdentityController</a></li>
<li><a class="el" href="classIotDash_1_1Controllers_1_1V1_1_1InterfaceController.html">IotDash.Controllers.V1.InterfaceController</a></li>
</ul>
<p >Hubs provide endpoints for SignalR clients, which enable two-way real-time communication with the clients. In this application, this functionality is only used for providing real-time MQTT data to the clients.</p><ul>
<li><a class="el" href="classIotDash_1_1Controllers_1_1V1_1_1EventHub.html">IotDash.Controllers.V1.EventHub</a></li>
</ul>
<h2><a class="anchor" id="autotoc_md7"></a>
Services</h2>
<p >The most of the application's functionality is wrapped in services (see <a class="el" href="index.html#autotoc_md3">Architecture</a>). This section contains their complete list.</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Model stores</h3>
<p >Model store classes provide abstraction over the database. Other services instead of directly accessing the database depend on these <a class="el" href="interfaceIotDash_1_1Services_1_1IModelStore.html" title="Represents a contract for a store object which provides CRUD operations on TEntity  indexed by TKey .">IotDash.Services.IModelStore</a> objects, which provide basic CRUD functionality over the database, plus some additional features like change detection.</p>
<p >These scoped services are registered in DI service container by <a class="el" href="classIotDash_1_1Installers_1_1DataInstaller.html">IotDash.Installers.DataInstaller</a>. The following interfaces represent the API of these services. Open them and check their inheritance diagrams to find the relevant implementations.</p><ul>
<li><a class="el" href="interfaceIotDash_1_1Services_1_1IInterfaceStore.html" title="This service provides CRUD operations on interfaces.">IotDash.Services.IInterfaceStore</a></li>
<li><a class="el" href="interfaceIotDash_1_1Services_1_1IUserStore.html" title="This service provides CRUD operations on IdentityUser indexed by their ids.">IotDash.Services.IUserStore</a></li>
<li><a class="el" href="interfaceIotDash_1_1Services_1_1IIdentityService.html" title="This service provides basic user account functionality.">IotDash.Services.IIdentityService</a></li>
<li><a class="el" href="interfaceIotDash_1_1Services_1_1IHistoryStore.html" title="This service provides database operations on HistoryEntrys.">IotDash.Services.IHistoryStore</a></li>
</ul>
<p >All these stores depend on <a class="el" href="classIotDash_1_1Data_1_1DataContext.html" title="Represents a connection to database">IotDash.Data.DataContext</a> which is also registered in by same installer. It is a scoped service, which means it is created once per HTTP request.</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Expression evaluation</h3>
<h3><a class="anchor" id="autotoc_md10"></a>
History logging</h3>
<h3><a class="anchor" id="autotoc_md11"></a>
MQTT Client</h3>
<p >The MQTT client is realised via the MQTTnet library. It provides the following service</p><ul>
<li><a class="el" href="classIotDash_1_1Services_1_1Mqtt_1_1MqttMediator.html" title="Specialisation of the AbstractMediator&lt;TChannelKey, TMsg&gt; where the channel key is of type string and...">IotDash.Services.Mqtt.MqttMediator</a> implemented by <a class="el" href="classIotDash_1_1Services_1_1Mqtt_1_1Implementation_1_1MqttNet__Mediator.html" title="A component of the HostedMqttService. Specialisation of MqttMediator designed to work with the MQTTne...">IotDash.Services.Mqtt.Implementation.MqttNet_Mediator</a></li>
</ul>
<p >The service is composed of classes in the <a class="el" href="namespaceIotDash_1_1Services_1_1Mqtt_1_1Implementation.html">IotDash.Services.Mqtt.Implementation</a> namespace.</p>
<h3><a class="anchor" id="autotoc_md12"></a>
Messaging</h3>
<h3><a class="anchor" id="autotoc_md13"></a>
Logging</h3>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4
</small></address>
</body>
</html>
